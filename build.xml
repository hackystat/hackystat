<project name="system.build" default="build.all">
  <description>
  The master build file for creating system-level releases of Hackystat.
  </description>
	
  <!-- Get today's version number. --> 
  <property name="majorVersionNumber" value="8" />
  <property name="minorVersionNumber" value="0" />
  <tstamp>
    <format property="DAYSTAMP" pattern="Mdd" />
  </tstamp>
  <property name="version" value="${majorVersionNumber}.${minorVersionNumber}.${DAYSTAMP}" />
  
  <!-- Define build system subdirectories -->
  <property name="system.build.dir" location="${basedir}/build"/>
  <property name="system.zip.dir" location="${basedir}/build/dist/dist"/>
  <property name="system.bin.dir" location="${basedir}/build/dist/bin"/>
  <mkdir dir="${system.zip.dir}"/>
  <mkdir dir="${system.bin.dir}"/>
  
  <!-- Now we override the following environment variables to point into this build. -->
  <property name="sensorbase.system.name" value="hackystat-sensorbase-uh"/>
  <property name="env.HACKYSTAT_SENSORBASE_HOME" location="${system.build.dir}/${sensorbase.system.name}" />
  <property name="utilities.system.name" value="hackystat-utilities"/>
  <property name="env.HACKYSTAT_UTILITIES_HOME" location="${system.build.dir}/${utilities.system.name}" />
  <property name="sensorshell.system.name" value="hackystat-sensor-shell"/>
  <property name="env.HACKYSTAT_SENSORSHELL_HOME" location="${system.build.dir}/${sensorshell.system.name}" />
   
  <!-- Now get the other environment variables (for JUnit, Checkstyle, etc.) --> 
  <property environment="env"/>

  <!-- Make sure that SvnKit is installed . --> 
  <available file="${env.SVNKIT_HOME}/svnkit.jar" type="file" property="svnkit.available"/>
  <fail message="This package requires SVNKit to be downloaded and SVNKIT_HOME defined" unless="svnkit.available"/>
 
  <!-- read in svn.username and svn.password -->
  <property file="svn.properties"/>

  <import file="macros.build.xml"/>
  
  <target name="build.all" 
    depends="build.utilities, build.sensorbase, build.sensorshell, build.ant, build.xmldata, build.emacs, build.eclipse"/>
  
  <target name="build.sensorbase">
    <buildModule module.name="${sensorbase.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${sensorbase.system.name}"/>
    <copyBin module.name="${sensorbase.system.name}" bin.name="sensorbase.jar"/>
    <copyBin module.name="${sensorbase.system.name}" bin.name="sensorbase.lib.jar"/>
  </target>
  
  <target name="build.utilities">
    <buildModule module.name="${utilities.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${utilities.system.name}"/>
    <copyBin module.name="${utilities.system.name}" bin.name="stacktrace.lib.jar"/>
    <copyBin module.name="${utilities.system.name}" bin.name="tstamp.lib.jar"/>
    <copyBin module.name="${utilities.system.name}" bin.name="uricache.lib.jar"/>
  </target>
  
  <target name="build.sensorshell">
    <buildModule module.name="${sensorshell.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${sensorshell.system.name}"/>
    <copyBin module.name="${sensorshell.system.name}" bin.name="sensorshell.jar"/>
  </target>
  
  <target name="build.ant">
    <property name="ant.system.name" value="hackystat-sensor-ant"/>
    <buildModule module.name="${ant.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${ant.system.name}"/>
    <copyBin module.name="${ant.system.name}" bin.name="antsensors.jar"/>
  </target>
  
  <target name="build.xmldata">
    <property name="xmldata.system.name" value="hackystat-sensor-xmldata"/>
    <buildModule module.name="${xmldata.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${xmldata.system.name}"/>
    <copyBin module.name="${xmldata.system.name}" bin.name="xmldata-cli.jar"/>
   </target>
  
  <target name="build.emacs">
    <property name="emacs.system.name" value="hackystat-sensor-emacs"/>
    <buildModule module.name="${emacs.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${emacs.system.name}"/>
    <copyBin module.name="${emacs.system.name}" bin.name="build/sensor-package.el"/>
  </target>
  
  <target name="build.eclipse">
    <property name="eclipse.system.name" value="hackystat-sensor-eclipse"/>
    <buildModule module.name="${eclipse.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${eclipse.system.name}"/>
    <copyBin module.name="${eclipse.system.name}" bin.name="hackystat-sensor-eclipse.zip"/>
  </target>
	
  <target name="build.sensordataviewer">
    <property name="sdv.system.name" value="hackystat-ui-sensordataviewer"/>
    <buildModule module.name="${sdv.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${sdv.system.name}"/>
    <copyBin module.name="${sdv.system.name}" bin.name="sensordataviewer.war"/>
  </target>
	
  <target name="build.sensordatabrowser">
    <property name="sdb.system.name" value="hackystat-ui-sensordatabrowser"/>
    <buildModule module.name="${sdb.system.name}" svn.username="${svn.username}" svn.password="${svn.password}" />
    <copyDist module.name="${sdb.system.name}"/>
    <copyBin module.name="${sdb.system.name}" bin.name="sensordatabrowser.war"/>
  </target>	
  
  <target name="clean" description="Delete build/ directory and top-level hackystat zip files.">
    <delete>
      <fileset dir="${basedir}" includes="hackystat*.zip"/> 
    </delete>
    <delete dir="${system.build.dir}"/> 
  </target>

</project>





