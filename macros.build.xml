<project name="macros" default="svn">
  
  <macrodef name="svn.checkout">
    <attribute name="svn.url"/>
    <attribute name="local.workspace"/>
    <attribute name="username"/>
    <attribute name="password"/>
      <sequential>
          <java classname="org.tmatesoft.svn.cli.SVN" fork="true" failonerror="true">
            <arg value="checkout"/>
            <arg value="@{svn.url}"/>
            <arg value="@{local.workspace}"/>
            <arg value="--username"/>
            <arg value="@{username}"/>
            <arg value="--password"/>
            <arg value="@{password}"/>
            <classpath>
              <pathelement location="${env.SVNKIT_HOME}/ganymed.jar" />
              <pathelement location="${env.SVNKIT_HOME}/svnkit.jar" />
              <pathelement location="${env.SVNKIT_HOME}/svnkit-cli.jar" />
            </classpath>
          </java>
      </sequential>
    </macrodef>  
  
  <macrodef name="svn.checkout.anonymous">
     <attribute name="svn.url"/>
     <attribute name="local.workspace"/>
       <sequential>
           <java classname="org.tmatesoft.svn.cli.SVN" fork="true" failonerror="true">
             <arg value="checkout"/>
             <arg value="@{svn.url}"/>
             <arg value="@{local.workspace}"/>
             <classpath>
               <pathelement location="${env.SVNKIT_HOME}/ganymed.jar" />
               <pathelement location="${env.SVNKIT_HOME}/svnkit.jar" />
               <pathelement location="${env.SVNKIT_HOME}/svnkit-cli.jar" />
             </classpath>
           </java>
       </sequential>
     </macrodef> 
  
  <macrodef name="svn.commit">
    <attribute name="svn.message"/>
    <attribute name="svn.username"/>
    <attribute name="svn.password"/>
    <attribute name="svn.module"/>
       <sequential>
           <java classname="org.tmatesoft.svn.cli.SVN" fork="true" failonerror="true">
             <arg value="commit"/>
             <arg value="--message"/>
             <arg value="'@{svn.message}'"/>
             <arg value="--username"/>
             <arg value="@{svn.username}"/>
             <arg value="--password"/>
             <arg value="@{svn.password}"/>
             <arg value="@{svn.module}"/>
             <classpath>
               <pathelement location="${env.SVNKIT_HOME}/ganymed.jar" />
               <pathelement location="${env.SVNKIT_HOME}/svnkit.jar" />
               <pathelement location="${env.SVNKIT_HOME}/svnkit-cli.jar" />
             </classpath>
           </java>
       </sequential>
     </macrodef> 
  
  <macrodef name="module.checkout.anonymous">
      <attribute name="module.name"/>
      <sequential>
        <mkdir dir="${system.build.dir}/@{module.name}"/>
        <svn.checkout.anonymous svn.url="http://@{module.name}.googlecode.com/svn/trunk/" 
                                local.workspace="${system.build.dir}/@{module.name}"  />
      </sequential>
  </macrodef>
  
  <macrodef name="module.checkout">
     <attribute name="svn.username"/>
     <attribute name="svn.password"/>
     <attribute name="module.name"/>
     <sequential>
       <mkdir dir="${system.build.dir}/@{module.name}"/>
       <svn.checkout svn.url="https://@{module.name}.googlecode.com/svn/trunk/" 
                     local.workspace="${system.build.dir}/@{module.name}"
                     username="@{svn.username}" 
                     password="@{svn.password}" />
     </sequential>
   </macrodef>

  <macrodef name="module.checkout.wiki">
      <attribute name="svn.username"/>
      <attribute name="svn.password"/>
      <attribute name="module.name"/>
      <sequential>
        <mkdir dir="${system.build.dir}/wiki-@{module.name}"/>
        <svn.checkout svn.url="https://@{module.name}.googlecode.com/svn/wiki/" 
                      local.workspace="${system.build.dir}/wiki-@{module.name}"
                      username="@{svn.username}" 
                      password="@{svn.password}" />
      </sequential>
    </macrodef>

  
  <macrodef name="buildModule">
    <attribute name="svn.username"/>
    <attribute name="svn.password"/>
    <attribute name="module.name"/>
    <sequential>
      <ant dir="${system.build.dir}/@{module.name}" antfile="verify.build.xml" />
      <ant dir="${system.build.dir}/@{module.name}" antfile="dist.build.xml" />
    </sequential>
  </macrodef>
  
  

  <macrodef name="copyServiceDist">
   <attribute name="module.name"/>
   <sequential>
     <mkdir dir="${system.services.dir}/dist"/>
     <copy file="${system.build.dir}/@{module.name}/build/dist/@{module.name}-${version}.zip" 
           todir="${system.services.dir}/dist"/>
   </sequential>
  </macrodef>

  <macrodef name="copyServiceBin">
   <attribute name="module.name"/>
   <attribute name="bin.name"/>
   <sequential>
     <mkdir dir="${system.services.dir}/bin/@{module.name}"/>
     <copy file="${system.build.dir}/@{module.name}/@{bin.name}" 
     	   todir="${system.services.dir}/bin/@{module.name}"/> 
   </sequential>
  </macrodef>
	
  <macrodef name="copyServiceBinDir">
   <attribute name="module.name"/>
   <attribute name="dir.name"/>
   <sequential>
     <mkdir dir="${system.services.dir}/bin/@{module.name}/@{dir.name}"/>
     <copy todir="${system.services.dir}/bin/@{module.name}/@{dir.name}">
       <fileset dir="${system.build.dir}/@{module.name}/@{dir.name}"/>
     </copy>     	
   </sequential>
  </macrodef>
	
  <macrodef name="copySensorDist">
   <attribute name="module.name"/>
   <sequential>
     <mkdir dir="${system.sensors.dir}/dist"/>
     <copy file="${system.build.dir}/@{module.name}/build/dist/@{module.name}-${version}.zip" 
           todir="${system.sensors.dir}/dist"/>
   </sequential>
  </macrodef>

  <macrodef name="copySensorBin">
   <attribute name="module.name"/>
   <attribute name="bin.name"/>
   <attribute name="bin.subdir" default=""/>  <!-- must start with '/' if supplied. For Eclipse sensor. -->
   <sequential>
     <mkdir dir="${system.sensors.dir}/bin/@{module.name}@{bin.subdir}"/>
     <copy file="${system.build.dir}/@{module.name}@{bin.subdir}/@{bin.name}" 
     	   todir="${system.sensors.dir}/bin/@{module.name}@{bin.subdir}"/>
   </sequential>
  </macrodef>	

  </project>